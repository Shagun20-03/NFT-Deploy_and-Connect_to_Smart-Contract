<html lang="en">

<head>
    <!--Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--jQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <!--Bootstrap CSS-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <!--Custom Stylesheet-->
    <link rel="stylesheet" href="/styles/style.css">

    <!--Favicon-->
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon">

    <title>NFT Website</title>
</head>

<body class="d-flex flex-column min-vh-100">
    <header>
        <!--Navigation bar-->
        <div class="navbar navbar-dark bg-dark shadow-sm">
            <div class="container">
                <a href="/" class="navbar-brand d-flex align-items-center">
                    <img src="/assets/favicon-32x32.png" alt="icon" width="35" height="35">
                    <strong>NFT MarketPlace</strong>
                </a>
            </div>
        </div>
    </header>

    <main class="form-product">
        <form id="get-product">
            <div class="mb-3"><label for="token-id" class="form-label">Enter the Token Id</label>
                <input type="number" class="" name="token-id" id="token-id" placeholder="" required>
            </div>
            <button id="submit-token" class="btn btn-warning">Submit</button>
        </form>
    </main>

    <table class="table table-sm">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">First</th>
            <th scope="col">Last</th>
            <th scope="col">Handle</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">1</th>
            <td>Mark</td>
            <td>Otto</td>
            <td>@mdo</td>
          </tr>
          <tr>
            <th scope="row">2</th>
            <td>Jacob</td>
            <td>Thornton</td>
            <td>@fat</td>
          </tr>
          <tr>
            <th scope="row">3</th>
            <td colspan="2">Larry the Bird</td>
            <td>@twitter</td>
          </tr>
        </tbody>
      </table>
      
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script type="module">
        var CONTRACT_ADDRESS = '0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512'; //Timer.sol
        var CONTRACT_DEPLOYED = true;

        var CONTRACT = undefined;
        // 1. connect to my MetaMask account
        //2. Deploy
        //3. connect to contract
        import connect from './Connect.js';
        import deploy from './Deploy.js';
        import getContract from './ConnContract.js';
        import { ethers } from './ethers.main.js';

        async function conn() {
            const account = await connect();
        }

        async function getCont() {
            CONTRACT = undefined;
            CONTRACT = await getContract(CONTRACT_ADDRESS);

            let content = '';
            if (CONTRACT) {
                content = 'Contract received!!!!';
            } else {
                content = 'Contract not available';
            }
            console.log(content);
        }
        const ip_addr = '54.83.105.94';
        //Custom functions
        const getProduct = async () => {
            var token1 = (document.querySelector("#token-id").value)
            if (token1) {
                console.log(token1)
            }
            else {
                console.log(token1)
                return;
            }
            await conn();
            await getCont();
            const ipfs_uri = await CONTRACT.tokenURI(
                Number(token1)
            )
            console.log(ipfs_uri)
            const response = await axios({
                method: "get",
                url: `http://${ip_addr}/ipfs/${ipfs_uri}`,
            })

            console.log(response.data);

            // if (!response.ok)
            //     throw new Error(response.statusText);

            // const json = await response.json();
            // console.log(json.image)
        };
        document.querySelector('#submit-token').addEventListener('click', async function (event) {
            event.preventDefault()
            await getProduct();
        });
    </script>
    
</body>

</html>